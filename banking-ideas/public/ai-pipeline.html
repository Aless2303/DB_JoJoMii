<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BANK//IDEAS - AI Pipeline Workflow</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            overflow: hidden;
            height: 100vh;
        }

        /* ===== HEADER ===== */
        .header {
            height: 56px;
            background: #161b22;
            border-bottom: 1px solid #30363d;
            display: flex;
            align-items: center;
            padding: 0 20px;
            justify-content: space-between;
            position: relative;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 16px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #58a6ff, #a371f7);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .logo span { color: #a371f7; }

        .divider {
            width: 1px;
            height: 24px;
            background: #30363d;
        }

        .workflow-name {
            font-size: 14px;
            color: #8b949e;
        }

        .header-center {
            display: flex;
            gap: 8px;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        .pill {
            background: #21262d;
            border: 1px solid #30363d;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            color: #8b949e;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .pill-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .pill-dot.green { background: #3fb950; }
        .pill-dot.blue { background: #58a6ff; }
        .pill-dot.purple { background: #a371f7; }

        .header-right {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.15s;
            border: none;
        }

        .btn-ghost {
            background: transparent;
            color: #c9d1d9;
            border: 1px solid #30363d;
        }

        .btn-ghost:hover {
            background: #21262d;
            border-color: #8b949e;
        }

        .btn-primary {
            background: #238636;
            color: #fff;
        }

        .btn-primary:hover {
            background: #2ea043;
        }

        .btn-primary.running {
            background: #9e6a03;
        }

        /* ===== MAIN LAYOUT ===== */
        .main {
            display: flex;
            height: calc(100vh - 56px);
        }

        /* ===== CANVAS AREA ===== */
        .canvas-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: 
                radial-gradient(circle at center, #161b22 0%, #0d1117 100%),
                repeating-linear-gradient(#21262d 0 1px, transparent 1px 100%),
                repeating-linear-gradient(90deg, #21262d 0 1px, transparent 1px 100%);
            background-size: 100% 100%, 20px 20px, 20px 20px;
        }

        .canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* SVG for connections */
        .connections-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .connection-path {
            fill: none;
            stroke: #30363d;
            stroke-width: 2;
        }

        .connection-path.active {
            stroke: #f0883e;
            stroke-width: 3;
            filter: drop-shadow(0 0 6px rgba(240, 136, 62, 0.5));
        }

        .connection-path.completed {
            stroke: #3fb950;
            stroke-width: 2;
        }

        /* Animated flow dots */
        .flow-dot {
            fill: #58a6ff;
            filter: drop-shadow(0 0 4px rgba(88, 166, 255, 0.8));
        }

        /* ===== NODES CONTAINER ===== */
        .nodes-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
        }

        /* ===== NODE ===== */
        .node {
            position: absolute;
            width: 240px;
            background: #161b22;
            border: 2px solid #30363d;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .node:hover {
            border-color: #58a6ff;
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(88, 166, 255, 0.2);
        }

        .node.selected {
            border-color: #a371f7;
            box-shadow: 0 0 0 3px rgba(163, 113, 247, 0.3), 0 8px 24px rgba(0, 0, 0, 0.5);
        }

        .node.running {
            border-color: #f0883e;
            animation: nodeGlow 1.5s ease-in-out infinite;
        }

        .node.completed {
            border-color: #3fb950;
        }

        .node.completed .node-status-indicator {
            background: #3fb950;
        }

        @keyframes nodeGlow {
            0%, 100% { box-shadow: 0 0 0 0 rgba(240, 136, 62, 0.4), 0 4px 12px rgba(0, 0, 0, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(240, 136, 62, 0), 0 4px 12px rgba(0, 0, 0, 0.4); }
        }

        /* Node Header */
        .node-header {
            padding: 12px 14px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid #21262d;
            position: relative;
        }

        .node-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .node-icon.input { background: linear-gradient(135deg, #388bfd, #1f6feb); }
        .node-icon.validator { background: linear-gradient(135deg, #3fb950, #238636); }
        .node-icon.analyzer { background: linear-gradient(135deg, #a371f7, #8957e5); }
        .node-icon.aggregator { background: linear-gradient(135deg, #f0883e, #d29922); }
        .node-icon.builder { background: linear-gradient(135deg, #f778ba, #db61a2); }
        .node-icon.stats { background: linear-gradient(135deg, #79c0ff, #58a6ff); }
        .node-icon.visual { background: linear-gradient(135deg, #7ee787, #56d364); }
        .node-icon.output { background: linear-gradient(135deg, #a371f7, #8957e5); }

        .node-info {
            flex: 1;
            min-width: 0;
        }

        .node-title {
            font-size: 14px;
            font-weight: 600;
            color: #f0f6fc;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .node-subtitle {
            font-size: 12px;
            color: #8b949e;
        }

        .node-status-indicator {
            position: absolute;
            top: -6px;
            right: -6px;
            width: 20px;
            height: 20px;
            background: #3fb950;
            border-radius: 50%;
            border: 3px solid #161b22;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #fff;
        }

        .node.completed .node-status-indicator {
            display: flex;
        }

        /* Node Body */
        .node-body {
            padding: 10px 14px;
        }

        .node-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .tag {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 500;
        }

        .tag-llm {
            background: rgba(163, 113, 247, 0.15);
            color: #a371f7;
            border: 1px solid rgba(163, 113, 247, 0.3);
        }

        .tag-function {
            background: rgba(63, 185, 80, 0.15);
            color: #3fb950;
            border: 1px solid rgba(63, 185, 80, 0.3);
        }

        .tag-parallel {
            background: rgba(88, 166, 255, 0.15);
            color: #58a6ff;
            border: 1px solid rgba(88, 166, 255, 0.3);
        }

        .tag-sequential {
            background: rgba(240, 136, 62, 0.15);
            color: #f0883e;
            border: 1px solid rgba(240, 136, 62, 0.3);
        }

        /* Connection Points */
        .connection-point {
            position: absolute;
            width: 14px;
            height: 14px;
            background: #30363d;
            border: 2px solid #484f58;
            border-radius: 50%;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            transition: all 0.15s;
        }

        .connection-point.left { left: -7px; }
        .connection-point.right { right: -7px; }

        .node:hover .connection-point,
        .node.selected .connection-point {
            background: #58a6ff;
            border-color: #58a6ff;
            box-shadow: 0 0 8px rgba(88, 166, 255, 0.5);
        }

        .node.completed .connection-point {
            background: #3fb950;
            border-color: #3fb950;
        }

        /* Parallel Group */
        .parallel-group {
            position: absolute;
            background: rgba(163, 113, 247, 0.05);
            border: 2px dashed rgba(163, 113, 247, 0.3);
            border-radius: 16px;
            padding: 50px 20px 20px 20px;
        }

        .parallel-label {
            position: absolute;
            top: 12px;
            left: 20px;
            font-size: 11px;
            font-weight: 600;
            color: #a371f7;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .parallel-label::before {
            content: '';
            width: 8px;
            height: 8px;
            background: #a371f7;
            border-radius: 2px;
        }

        /* ===== SIDE PANEL ===== */
        .panel {
            width: 380px;
            background: #161b22;
            border-left: 1px solid #30363d;
            display: flex;
            flex-direction: column;
            transform: translateX(100%);
            transition: transform 0.25s ease;
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            z-index: 50;
        }

        .panel.open {
            transform: translateX(0);
        }

        .panel-header {
            padding: 16px 20px;
            border-bottom: 1px solid #30363d;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #0d1117;
        }

        .panel-title-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .panel-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            background: linear-gradient(135deg, #a371f7, #8957e5);
        }

        .panel-title {
            font-size: 15px;
            font-weight: 600;
            color: #f0f6fc;
        }

        .panel-close {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            border: 1px solid #30363d;
            background: #21262d;
            color: #f0f6fc;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
            flex-shrink: 0;
        }

        .panel-close:hover {
            background: #f85149;
            border-color: #f85149;
            color: #fff;
        }

        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .panel-section {
            margin-bottom: 24px;
        }

        .panel-section-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #8b949e;
            margin-bottom: 10px;
        }

        .panel-card {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 14px;
        }

        .panel-card p {
            font-size: 13px;
            line-height: 1.6;
            color: #c9d1d9;
        }

        .code-block {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 14px;
            overflow-x: auto;
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 12px;
            line-height: 1.5;
            color: #79c0ff;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .detail-item {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 12px;
        }

        .detail-label {
            font-size: 11px;
            color: #8b949e;
            margin-bottom: 4px;
        }

        .detail-value {
            font-size: 14px;
            font-weight: 500;
            color: #f0f6fc;
        }

        /* ===== PROGRESS BAR ===== */
        .progress-bar {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 12px;
            padding: 16px 24px;
            min-width: 400px;
            display: none;
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.6);
            z-index: 1000;
        }

        .progress-bar.visible {
            display: block;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateX(-50%) translateY(20px); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .progress-title {
            font-size: 13px;
            font-weight: 600;
            color: #f0f6fc;
        }

        .progress-status {
            font-size: 12px;
            color: #8b949e;
        }

        .progress-track {
            height: 4px;
            background: #21262d;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #58a6ff, #a371f7, #3fb950);
            width: 0%;
            transition: width 0.4s ease;
            border-radius: 2px;
        }

        /* ===== ZOOM CONTROLS ===== */
        .zoom-controls {
            position: absolute;
            bottom: 24px;
            right: 24px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            z-index: 10;
        }

        .zoom-btn {
            width: 36px;
            height: 36px;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            color: #c9d1d9;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s;
        }

        .zoom-btn:hover {
            background: #21262d;
            border-color: #8b949e;
        }

        /* ===== MINIMAP ===== */
        .minimap {
            position: absolute;
            bottom: 24px;
            left: 24px;
            width: 160px;
            height: 100px;
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            overflow: hidden;
            z-index: 10;
        }

        .minimap-content {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .minimap-node {
            position: absolute;
            background: #58a6ff;
            border-radius: 2px;
        }

        .minimap-viewport {
            position: absolute;
            border: 2px solid #a371f7;
            background: rgba(163, 113, 247, 0.1);
            border-radius: 2px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0d1117; }
        ::-webkit-scrollbar-thumb { background: #30363d; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #484f58; }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <div class="logo">
                <div class="logo-icon">üè¶</div>
                <span>BANK//</span>IDEAS
            </div>
            <div class="divider"></div>
            <div class="workflow-name">AI Pipeline Workflow</div>
        </div>

        <div class="header-center">
            <div class="pill">
                <span class="pill-dot green"></span>
                11 Agents
            </div>
            <div class="pill">
                <span class="pill-dot blue"></span>
                Vercel AI SDK
            </div>
            <div class="pill">
                <span class="pill-dot purple"></span>
                Claude 3 Haiku
            </div>
        </div>

        <div class="header-right">
            <button class="btn btn-ghost" onclick="resetPipeline()">
                ‚Üª Reset
            </button>
            <button class="btn btn-primary" id="runBtn" onclick="runPipeline()">
                ‚ñ∂ Run Pipeline
            </button>
        </div>
    </header>

    <!-- Main -->
    <div class="main">
        <div class="canvas-container" id="canvasContainer">
            <!-- SVG Connections -->
            <svg class="connections-svg" id="connectionsSvg">
                <defs>
                    <marker id="arrowhead" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
                        <path d="M0,0 L12,4 L0,8 L3,4 Z" fill="#30363d"/>
                    </marker>
                    <marker id="arrowhead-active" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
                        <path d="M0,0 L12,4 L0,8 L3,4 Z" fill="#f0883e"/>
                    </marker>
                    <marker id="arrowhead-completed" markerWidth="12" markerHeight="8" refX="10" refY="4" orient="auto">
                        <path d="M0,0 L12,4 L0,8 L3,4 Z" fill="#3fb950"/>
                    </marker>
                </defs>
            </svg>

            <!-- Nodes Container -->
            <div class="nodes-container" id="nodesContainer">
                <!-- Parallel Group -->
                <div class="parallel-group" id="parallelGroup">
                    <div class="parallel-label">Parallel Execution ‚Ä¢ Promise.all()</div>
                </div>

                <!-- Nodes will be created by JavaScript -->
            </div>

            <!-- Zoom Controls -->
            <div class="zoom-controls">
                <button class="zoom-btn" onclick="zoomIn()">+</button>
                <button class="zoom-btn" onclick="zoomOut()">‚àí</button>
                <button class="zoom-btn" onclick="zoomReset()">‚äô</button>
            </div>
        </div>

        <!-- Side Panel -->
        <div class="panel" id="panel">
            <div class="panel-header">
                <div class="panel-title-wrapper">
                    <div class="panel-icon" id="panelIcon">üìù</div>
                    <div class="panel-title" id="panelTitle">Agent Details</div>
                </div>
                <button class="panel-close" onclick="closePanel()" title="Close panel">‚úï</button>
            </div>
            <div class="panel-content" id="panelContent"></div>
        </div>
    </div>

    <!-- Progress Bar -->
    <div class="progress-bar" id="progressBar">
        <div class="progress-header">
            <div class="progress-title">üöÄ Running Pipeline</div>
            <div class="progress-status" id="progressStatus">Initializing...</div>
        </div>
        <div class="progress-track">
            <div class="progress-fill" id="progressFill"></div>
        </div>
    </div>

    <script>
        // ===== NODE DEFINITIONS - UPDATED FROM REPOSITORY =====
        const nodes = [
            {
                id: 'input',
                title: 'Form Input',
                subtitle: '7-Step Form',
                icon: 'üìù',
                iconClass: 'input',
                tags: ['Zod', 'React Hook Form'],
                tagTypes: ['function', 'function'],
                x: 60,
                y: 280,
                description: 'A comprehensive 7-step form that collects all information about the banking innovation idea. Each step focuses on different aspects: basic info, technologies, business context, regulations, differentiators, and additional details.',
                schema: `const IdeaFormSchema = z.object({
  // Step 1: Basic Info
  title: z.string().min(3).max(60),
  shortDescription: z.string().min(10).max(280),
  category: z.enum(["payments", "lending", 
    "investments", "customer-experience", 
    "security", "open-banking", 
    "sustainability", "other"]),
  problemSolved: z.string().min(20),

  // Step 2: Technologies
  aiTechnologies: z.array(z.enum([...])),
  blockchainTechnologies: z.array(z.enum([...])),
  otherTechnologies: z.array(z.enum([...])),

  // Step 3-7: Business, Regulations, etc.
  ...
});`,
                details: [
                    { label: 'Steps', value: '7' },
                    { label: 'Fields', value: '20+' },
                    { label: 'Validation', value: 'Zod' },
                    { label: 'Storage', value: 'PostgreSQL' }
                ]
            },
            {
                id: 'validator',
                title: 'Validator Agent',
                subtitle: 'claude-3-haiku',
                icon: 'üîç',
                iconClass: 'validator',
                tags: ['LLM', 'Sequential'],
                tagTypes: ['llm', 'sequential'],
                x: 380,
                y: 280,
                description: 'Acts as a FRAUD DETECTOR at Deutsche Bank. Validates, normalizes, and enriches raw form data. Calculates credibility scores, checks banking relevance, detects satirical/fake submissions, and determines maximum possible scores. Never leaves fields empty.',
                schema: `const ValidatedIdeaSchema = z.object({
  ideaTitle: z.string(),
  bigIdea: z.string(),
  mainCategory: z.string(),
  coreTechnologies: z.array(z.string()),
  applicableRegulations: z.array(z.string()),
  projectStage: z.string(),
  // ... normalized fields ...
  
  // PRE-SCORING FIELDS
  credibilityScore: z.number().min(0).max(100),
  bankingRelevance: z.enum([
    "high", "medium", "low", "none"
  ]),
  consistencyIssues: z.array(z.string()),
  isSatiricalOrFake: z.boolean(),
  maxPossibleScore: z.number().min(0).max(100)
});`,
                details: [
                    { label: 'Model', value: 'claude-3-haiku' },
                    { label: 'Role', value: 'Fraud Detector' },
                    { label: 'Method', value: 'generateObject()' },
                    { label: 'Execution', value: 'Sequential' }
                ]
            },
            {
                id: 'basic',
                title: 'Basic Info Analyzer',
                subtitle: 'claude-3-haiku',
                icon: 'üìã',
                iconClass: 'analyzer',
                tags: ['LLM', 'Parallel'],
                tagTypes: ['llm', 'parallel'],
                x: 720,
                y: 60,
                isParallel: true,
                description: 'Acts as a TOP FINTECH COPYWRITER and PITCH EXPERT who has helped secure $500M+ in funding. Creates captivating headlines, punchy taglines, rewrites problems as urgent crises, generates quantifiable benefits, and identifies exact target audience.',
                schema: `const BasicInfoAnalysisSchema = z.object({
  headline: z.string()
    .describe("Captivating headline for the idea"),
  tagline: z.string()
    .describe("Short marketing slogan"),
  category: z.string()
    .describe("Simplified category (1-2 words)"),
  problemSummary: z.string()
    .describe("Problem as an urgent crisis"),
  keyBenefits: z.array(z.string())
    .describe("5 concrete, quantifiable benefits"),
  targetAudience: z.string()
    .describe("Exact description of users & buyers")
});`,
                details: [
                    { label: 'Model', value: 'claude-3-haiku' },
                    { label: 'Role', value: 'Pitch Expert' },
                    { label: 'Output', value: 'Headlines & Copy' },
                    { label: 'Execution', value: 'Parallel' }
                ]
            },
            {
                id: 'tech',
                title: 'Technologies Analyzer',
                subtitle: 'claude-3-haiku',
                icon: '‚ö°',
                iconClass: 'analyzer',
                tags: ['LLM', 'Parallel'],
                tagTypes: ['llm', 'parallel'],
                x: 720,
                y: 165,
                isParallel: true,
                description: 'Acts as a TECH LEAD and SOFTWARE ARCHITECT with 15 years of experience in mission-critical banking systems. Analyzes tech stack, suggests complementary technologies, evaluates innovation level, and provides technical recommendations.',
                schema: `const TechnologiesAnalysisSchema = z.object({
  primaryTech: z.array(z.string())
    .describe("List of 5-8 key technologies"),
  techCategory: z.string()
    .describe("Architectural classification"),
  innovationLevel: z.enum([
    "breakthrough", "cutting-edge", 
    "modern", "traditional"
  ]).describe("Innovation level assessment"),
  techSummary: z.string()
    .describe("100-200 word technical analysis"),
  techBadges: z.array(z.string())
    .describe("4-6 impressive badges for UI")
});`,
                details: [
                    { label: 'Model', value: 'claude-3-haiku' },
                    { label: 'Role', value: 'Tech Lead / CTO' },
                    { label: 'Evaluates', value: 'Innovation Level' },
                    { label: 'Execution', value: 'Parallel' }
                ]
            },
            {
                id: 'business',
                title: 'Business Analyzer',
                subtitle: 'claude-3-haiku',
                icon: 'üíº',
                iconClass: 'analyzer',
                tags: ['LLM', 'Parallel'],
                tagTypes: ['llm', 'parallel'],
                x: 720,
                y: 270,
                isParallel: true,
                description: 'Analyzes market opportunity with specific numbers and trends, evaluates revenue model with calculations, assesses business value proposition for Deutsche Bank, and determines scalability score.',
                schema: `const BusinessContextAnalysisSchema = z.object({
  segment: z.string()
    .describe("Market segment with size"),
  revenueModel: z.string()
    .describe("Detailed revenue model"),
  marketOpportunity: z.string()
    .describe("Opportunity with numbers/trends"),
  businessValue: z.string()
    .describe("Value proposition for DB"),
  scalabilityScore: z.enum([
    "massive", "high", "medium", "limited"
  ]).describe("Scalability assessment")
});`,
                details: [
                    { label: 'Model', value: 'claude-3-haiku' },
                    { label: 'Role', value: 'Strategist' },
                    { label: 'Output', value: 'Market Analysis' },
                    { label: 'Execution', value: 'Parallel' }
                ]
            },
            {
                id: 'regulations',
                title: 'Regulations Analyzer',
                subtitle: 'claude-3-haiku',
                icon: '‚öñÔ∏è',
                iconClass: 'analyzer',
                tags: ['LLM', 'Parallel'],
                tagTypes: ['llm', 'parallel'],
                x: 720,
                y: 375,
                isParallel: true,
                description: 'Acts as a COMPLIANCE OFFICER and REGULATORY EXPERT with 20 years of experience in European banking. Evaluates compliance status, identifies all applicable regulations (GDPR, PSD2, DORA, AML, MiFID II, etc.), assesses risk level, and provides actionable compliance guidance.',
                schema: `const RegulationsAnalysisSchema = z.object({
  complianceStatus: z.enum([
    "compliant", "partial", 
    "needs-review", "non-compliant"
  ]).describe("Compliance status assessment"),
  keyRegulations: z.array(z.string())
    .describe("Complete list of regulations"),
  riskLevel: z.enum([
    "low", "medium", "high", "critical"
  ]).describe("Regulatory risk level"),
  complianceSummary: z.string()
    .describe("150-250 word actionable analysis")
});`,
                details: [
                    { label: 'Model', value: 'claude-3-haiku' },
                    { label: 'Role', value: 'Compliance Officer' },
                    { label: 'Checks', value: 'GDPR, PSD2, DORA' },
                    { label: 'Execution', value: 'Parallel' }
                ]
            },
            {
                id: 'differentiators',
                title: 'Differentiators Analyzer',
                subtitle: 'claude-3-haiku',
                icon: 'üéØ',
                iconClass: 'analyzer',
                tags: ['LLM', 'Parallel'],
                tagTypes: ['llm', 'parallel'],
                x: 720,
                y: 480,
                isParallel: true,
                description: 'Rewrites unique value proposition as a compelling 30-second pitch, identifies sustainable competitive moat, honestly evaluates production readiness level, and generates implementation badges showing what is ready.',
                schema: `const DifferentiatorsAnalysisSchema = z.object({
  uniqueSellingPoint: z.string()
    .describe("30-second pitch rewrite"),
  competitiveAdvantage: z.string()
    .describe("Sustainable competitive moat"),
  readinessLevel: z.enum([
    "production-ready", "beta", 
    "working-prototype", 
    "proof-of-concept", "concept"
  ]).describe("Maturity assessment"),
  implementationBadges: z.array(z.string())
    .describe("4-6 badges showing what's ready"),
  githubAvailable: z.boolean()
    .describe("Whether GitHub link exists")
});`,
                details: [
                    { label: 'Model', value: 'claude-3-haiku' },
                    { label: 'Role', value: 'Product Manager' },
                    { label: 'Output', value: 'USP & Readiness' },
                    { label: 'Execution', value: 'Parallel' }
                ]
            },
            {
                id: 'other',
                title: 'Other Details Analyzer',
                subtitle: 'claude-3-haiku',
                icon: 'üìé',
                iconClass: 'analyzer',
                tags: ['LLM', 'Parallel'],
                tagTypes: ['llm', 'parallel'],
                x: 720,
                y: 585,
                isParallel: true,
                description: 'Acts as a PROGRAM MANAGER for a startup accelerator at Deutsche Bank. Evaluates team composition with commentary, identifies concrete support needed from DB, and highlights additional strengths for the pitch.',
                schema: `const OtherDetailsAnalysisSchema = z.object({
  teamSize: z.string()
    .describe("Team evaluation with commentary"),
  hasDemo: z.boolean()
    .describe("Whether demo exists"),
  supportNeeded: z.array(z.string())
    .describe("4-6 types of support from DB"),
  additionalHighlights: z.array(z.string())
    .describe("4-6 additional pitch strengths")
});`,
                details: [
                    { label: 'Model', value: 'claude-3-haiku' },
                    { label: 'Role', value: 'Program Manager' },
                    { label: 'Output', value: 'Team & Resources' },
                    { label: 'Execution', value: 'Parallel' }
                ]
            },
            {
                id: 'aggregator',
                title: 'Aggregator',
                subtitle: 'Pure Function',
                icon: 'üîÄ',
                iconClass: 'aggregator',
                tags: ['No LLM', 'Merge'],
                tagTypes: ['function', 'sequential'],
                x: 1040,
                y: 280,
                description: 'Pure function (NO LLM) that merges all 6 analysis results into a single structured object. Zero cost, instant execution.',
                code: `export function aggregateAnalyses(
  validatedData: ValidatedIdea,
  basicInfo: BasicInfoAnalysis,
  technologies: TechnologiesAnalysis,
  businessContext: BusinessContextAnalysis,
  regulations: RegulationsAnalysis,
  differentiators: DifferentiatorsAnalysis,
  otherDetails: OtherDetailsAnalysis
): AggregatedData {
  return {
    basicInfo,
    technologies,
    businessContext,
    regulations,
    differentiators,
    otherDetails,
    originalData: validatedData
  };
}`,
                details: [
                    { label: 'Type', value: 'Pure Function' },
                    { label: 'LLM Cost', value: '$0' },
                    { label: 'Purpose', value: 'Merge Data' },
                    { label: 'Execution', value: 'Instant' }
                ]
            },
            {
                id: 'htmlbuilder',
                title: 'HTML Builder',
                subtitle: 'claude-3-haiku',
                icon: 'üèóÔ∏è',
                iconClass: 'builder',
                tags: ['LLM', 'Sequential'],
                tagTypes: ['llm', 'sequential'],
                x: 1360,
                y: 280,
                description: 'Acts as a CONTENT STRATEGIST for a top consulting firm. Creates compelling page structure with sections (hero, features, tech, business, social-proof, CTA), generates headlines and content that sells the idea to decision makers.',
                schema: `const HTMLBuilderOutputSchema = z.object({
  pageTitle: z.string(),
  sections: z.array(z.object({
    id: z.string(),
    type: z.enum([
      "hero", "features", "tech", 
      "business", "social-proof", "cta"
    ]),
    content: z.object({
      title: z.string(),
      subtitle: z.string().optional(),
      items: z.array(z.string()).optional(),
      badges: z.array(z.string()).optional(),
      highlight: z.string().optional()
    })
  })),
  callToAction: z.object({
    primary: z.string(),
    secondary: z.string().optional()
  }),
  metadata: z.object({
    category: z.string(),
    readinessLevel: z.string(),
    innovationLevel: z.string()
  })
});`,
                details: [
                    { label: 'Model', value: 'claude-3-haiku' },
                    { label: 'Role', value: 'Content Strategist' },
                    { label: 'Output', value: 'Page Structure' },
                    { label: 'Execution', value: 'Sequential' }
                ]
            },
            {
                id: 'statistician',
                title: 'Statistician',
                subtitle: 'claude-3-haiku',
                icon: 'üìä',
                iconClass: 'stats',
                tags: ['LLM', 'Scoring'],
                tagTypes: ['llm', 'sequential'],
                x: 1680,
                y: 280,
                description: 'Acts as a SENIOR INVESTMENT COMMITTEE MEMBER at Deutsche Bank. Uses pre-scoring results (credibility, banking relevance, maxPossibleScore) from validator to cap scores. Evaluates on 5 axes: Innovation, Feasibility, Business Value, Compliance, and Readiness. Provides final recommendation.',
                schema: `const StatisticsOutputSchema = z.object({
  overallScore: z.number().min(0).max(100)
    .describe("Weighted average, capped by maxPossibleScore"),
  categoryScores: z.object({
    innovation: z.number().min(0).max(100),
    feasibility: z.number().min(0).max(100),
    businessValue: z.number().min(0).max(100),
    compliance: z.number().min(0).max(100),
    readiness: z.number().min(0).max(100)
  }),
  strengths: z.array(z.string()).min(1).max(5),
  improvements: z.array(z.string()).min(1).max(5),
  recommendation: z.enum([
    "highly-recommended", "recommended",
    "consider", "needs-work", "not-recommended"
  ]),
  summaryText: z.string()
    .describe("Executive summary for committee")
});`,
                details: [
                    { label: 'Model', value: 'claude-3-haiku' },
                    { label: 'Role', value: 'Investment Committee' },
                    { label: 'Scoring', value: '5 Axes + Cap' },
                    { label: 'Output', value: 'Final Verdict' }
                ]
            },
            {
                id: 'visual',
                title: 'Visual Designer',
                subtitle: 'Pure Function',
                icon: 'üé®',
                iconClass: 'visual',
                tags: ['No LLM', 'HTML Gen'],
                tagTypes: ['function', 'sequential'],
                x: 2000,
                y: 280,
                description: 'Pure function that generates the complete Teletext-style HTML page with all data, scores, and styling. Uses VT323 monospace font, dark blue background (#0000AA), and classic teletext colors (cyan, yellow, magenta, green). Zero LLM cost.',
                code: `export function designVisualOutput(
  data: AggregatedData,
  htmlContent: HTMLBuilderOutput,
  statistics: StatisticsOutput,
  originalTitle: string
): FinalVisualOutput {
  
  // Utility functions
  const scoreColor = (score: number) => 
    score >= 70 ? "#00FF00" : 
    score >= 50 ? "#FFFF00" : "#FF6600";
  
  const makeProgressBar = (score: number) => {
    const filled = Math.round(score / 10);
    return "[" + "‚ñà".repeat(filled) + 
           "‚ñë".repeat(10-filled) + "] " + score + "%";
  };

  // Generate full HTML with teletext styling
  const html = \`<div style="font-family:'VT323',
    monospace;background:#0000AA;...">
    <!-- Full Teletext HTML -->
  </div>\`;
  
  return { pages, htmlOutput: html, cssVariables };
}`,
                details: [
                    { label: 'Type', value: 'Pure Function' },
                    { label: 'LLM Cost', value: '$0' },
                    { label: 'Output', value: 'Teletext HTML' },
                    { label: 'Style', value: 'VT323 / Blue BG' }
                ]
            },
            {
                id: 'output',
                title: 'Generated Page',
                subtitle: 'PostgreSQL',
                icon: 'üì∫',
                iconClass: 'output',
                tags: ['Storage', 'Final'],
                tagTypes: ['function', 'sequential'],
                x: 2320,
                y: 280,
                description: 'The final output - a complete Teletext-style HTML page stored in PostgreSQL (generatedHtml, aiScore, aiAnalysis, aiRecommendation fields) and displayed to the user with all analysis and scores.',
                schema: `// Database Schema (ideas table)
generatedPages: text("generated_pages"), // JSON
generatedHtml: text("generated_html"),   // Full HTML
aiScore: integer("ai_score"),            // 0-100
aiAnalysis: text("ai_analysis"),         // JSON
aiRecommendation: text("ai_recommendation"),
  // "highly-recommended" | "recommended" | 
  // "consider" | "needs-work" | "not-recommended"

// Pipeline Result Interface
interface PipelineResult {
  success: boolean;
  validatedData: ValidatedIdea;
  aggregatedAnalysis: AggregatedData;
  statistics: StatisticsOutput;
  visualOutput: {
    pages: TeletextPage[];
    htmlOutput: string;
    cssVariables: object;
  };
}`,
                details: [
                    { label: 'Storage', value: 'PostgreSQL' },
                    { label: 'Format', value: 'Teletext HTML' },
                    { label: 'Access', value: '/ideas/[id]' },
                    { label: 'Fields', value: '5 AI columns' }
                ]
            }
        ];

        // ===== CONNECTIONS =====
        const connections = [
            { from: 'input', to: 'validator' },
            { from: 'validator', to: 'basic' },
            { from: 'validator', to: 'tech' },
            { from: 'validator', to: 'business' },
            { from: 'validator', to: 'regulations' },
            { from: 'validator', to: 'differentiators' },
            { from: 'validator', to: 'other' },
            { from: 'basic', to: 'aggregator' },
            { from: 'tech', to: 'aggregator' },
            { from: 'business', to: 'aggregator' },
            { from: 'regulations', to: 'aggregator' },
            { from: 'differentiators', to: 'aggregator' },
            { from: 'other', to: 'aggregator' },
            { from: 'aggregator', to: 'htmlbuilder' },
            { from: 'htmlbuilder', to: 'statistician' },
            { from: 'statistician', to: 'visual' },
            { from: 'visual', to: 'output' }
        ];

        // ===== STATE =====
        let isRunning = false;
        let zoom = 1;
        let panX = 0;
        let panY = 0;

        // ===== INITIALIZE =====
        function init() {
            createNodes();
            drawConnections();
            setupPanning();
        }

        // ===== CREATE NODES =====
        function createNodes() {
            const container = document.getElementById('nodesContainer');
            const parallelGroup = document.getElementById('parallelGroup');
            
            // Position parallel group
            parallelGroup.style.left = '700px';
            parallelGroup.style.top = '30px';
            parallelGroup.style.width = '280px';
            parallelGroup.style.height = '650px';

            nodes.forEach(node => {
                const el = document.createElement('div');
                el.className = 'node';
                el.id = `node-${node.id}`;
                el.setAttribute('data-id', node.id);
                el.style.left = node.x + 'px';
                el.style.top = node.y + 'px';
                
                el.innerHTML = `
                    <div class="connection-point left"></div>
                    <div class="connection-point right"></div>
                    <div class="node-status-indicator">‚úì</div>
                    <div class="node-header">
                        <div class="node-icon ${node.iconClass}">${node.icon}</div>
                        <div class="node-info">
                            <div class="node-title">${node.title}</div>
                            <div class="node-subtitle">${node.subtitle}</div>
                        </div>
                    </div>
                    <div class="node-body">
                        <div class="node-tags">
                            ${node.tags.map((tag, i) => `<span class="tag tag-${node.tagTypes[i]}">${tag}</span>`).join('')}
                        </div>
                    </div>
                `;
                
                el.onclick = () => showPanel(node.id);
                container.appendChild(el);
            });
        }

        // ===== DRAW CONNECTIONS =====
        function drawConnections() {
            const svg = document.getElementById('connectionsSvg');
            
            // Clear existing paths
            svg.querySelectorAll('path').forEach(p => p.remove());
            
            connections.forEach((conn, idx) => {
                const fromNode = document.getElementById(`node-${conn.from}`);
                const toNode = document.getElementById(`node-${conn.to}`);
                
                if (!fromNode || !toNode) return;
                
                const fromRect = fromNode.getBoundingClientRect();
                const toRect = toNode.getBoundingClientRect();
                const container = document.getElementById('canvasContainer').getBoundingClientRect();
                
                // Calculate connection points
                const fromX = fromRect.right - container.left - 7;
                const fromY = fromRect.top - container.top + fromRect.height / 2;
                const toX = toRect.left - container.left + 7;
                const toY = toRect.top - container.top + toRect.height / 2;
                
                // Create smooth bezier curve
                const midX = (fromX + toX) / 2;
                const controlOffset = Math.min(Math.abs(toX - fromX) * 0.5, 100);
                
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                const d = `M ${fromX} ${fromY} C ${fromX + controlOffset} ${fromY}, ${toX - controlOffset} ${toY}, ${toX} ${toY}`;
                
                path.setAttribute('d', d);
                path.setAttribute('class', 'connection-path');
                path.setAttribute('data-from', conn.from);
                path.setAttribute('data-to', conn.to);
                path.setAttribute('marker-end', 'url(#arrowhead)');
                
                svg.appendChild(path);
            });
        }

        // ===== SETUP PANNING =====
        function setupPanning() {
            const container = document.getElementById('canvasContainer');
            let isPanning = false;
            let startX, startY;
            
            container.addEventListener('mousedown', (e) => {
                if (e.target === container || e.target.classList.contains('connections-svg')) {
                    isPanning = true;
                    startX = e.clientX - panX;
                    startY = e.clientY - panY;
                    container.style.cursor = 'grabbing';
                }
            });
            
            document.addEventListener('mousemove', (e) => {
                if (isPanning) {
                    panX = e.clientX - startX;
                    panY = e.clientY - startY;
                    updateTransform();
                }
            });
            
            document.addEventListener('mouseup', () => {
                isPanning = false;
                container.style.cursor = 'default';
            });
        }

        function updateTransform() {
            const nodesContainer = document.getElementById('nodesContainer');
            const svg = document.getElementById('connectionsSvg');
            nodesContainer.style.transform = `translate(${panX}px, ${panY}px) scale(${zoom})`;
            svg.style.transform = `translate(${panX}px, ${panY}px) scale(${zoom})`;
        }

        function zoomIn() {
            zoom = Math.min(zoom + 0.1, 2);
            updateTransform();
        }

        function zoomOut() {
            zoom = Math.max(zoom - 0.1, 0.5);
            updateTransform();
        }

        function zoomReset() {
            zoom = 1;
            panX = 0;
            panY = 0;
            updateTransform();
        }

        // ===== SHOW PANEL =====
        function showPanel(id) {
            const node = nodes.find(n => n.id === id);
            if (!node) return;
            
            // Update selection
            document.querySelectorAll('.node').forEach(n => n.classList.remove('selected'));
            document.getElementById(`node-${id}`).classList.add('selected');
            
            // Update panel
            document.getElementById('panelIcon').textContent = node.icon;
            document.getElementById('panelTitle').textContent = node.title;
            
            let html = `
                <div class="panel-section">
                    <div class="panel-section-title">Description</div>
                    <div class="panel-card">
                        <p>${node.description}</p>
                    </div>
                </div>
            `;
            
            if (node.schema) {
                html += `
                    <div class="panel-section">
                        <div class="panel-section-title">Zod Schema</div>
                        <div class="code-block">${node.schema}</div>
                    </div>
                `;
            }
            
            if (node.code) {
                html += `
                    <div class="panel-section">
                        <div class="panel-section-title">Implementation</div>
                        <div class="code-block">${node.code}</div>
                    </div>
                `;
            }
            
            if (node.details) {
                html += `
                    <div class="panel-section">
                        <div class="panel-section-title">Details</div>
                        <div class="detail-grid">
                            ${node.details.map(d => `
                                <div class="detail-item">
                                    <div class="detail-label">${d.label}</div>
                                    <div class="detail-value">${d.value}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('panelContent').innerHTML = html;
            document.getElementById('panel').classList.add('open');
        }

        function closePanel() {
            document.getElementById('panel').classList.remove('open');
            document.querySelectorAll('.node').forEach(n => n.classList.remove('selected'));
        }

        // ===== RUN PIPELINE =====
        async function runPipeline() {
            if (isRunning) return;
            isRunning = true;
            
            const btn = document.getElementById('runBtn');
            const progress = document.getElementById('progressBar');
            const fill = document.getElementById('progressFill');
            const status = document.getElementById('progressStatus');
            
            resetPipeline();
            await sleep(100);
            
            btn.classList.add('running');
            btn.innerHTML = '‚è≥ Running...';
            progress.classList.add('visible');
            
            const steps = [
                { ids: ['input'], msg: 'Processing form input...', pct: 8 },
                { ids: ['validator'], msg: 'Validating & fraud detection...', pct: 18 },
                { ids: ['basic', 'tech', 'business', 'regulations', 'differentiators', 'other'], msg: 'Running 6 analyzers in parallel...', pct: 55, parallel: true },
                { ids: ['aggregator'], msg: 'Aggregating analyses...', pct: 65 },
                { ids: ['htmlbuilder'], msg: 'Building HTML structure...', pct: 75 },
                { ids: ['statistician'], msg: 'Calculating scores (with caps)...', pct: 85 },
                { ids: ['visual'], msg: 'Designing Teletext output...', pct: 95 },
                { ids: ['output'], msg: 'Complete!', pct: 100 }
            ];
            
            for (let i = 0; i < steps.length; i++) {
                const step = steps[i];
                
                status.textContent = step.msg;
                fill.style.width = step.pct + '%';
                
                // Set running state
                step.ids.forEach(id => {
                    document.getElementById(`node-${id}`).classList.add('running');
                    // Activate connections TO this node
                    document.querySelectorAll(`path[data-to="${id}"]`).forEach(p => {
                        p.classList.add('active');
                        p.setAttribute('marker-end', 'url(#arrowhead-active)');
                    });
                });
                
                await sleep(step.parallel ? 2000 : 800);
                
                // Set completed state
                step.ids.forEach(id => {
                    const node = document.getElementById(`node-${id}`);
                    node.classList.remove('running');
                    node.classList.add('completed');
                    // Complete connections TO this node
                    document.querySelectorAll(`path[data-to="${id}"]`).forEach(p => {
                        p.classList.remove('active');
                        p.classList.add('completed');
                        p.setAttribute('marker-end', 'url(#arrowhead-completed)');
                    });
                });
            }
            
            status.textContent = '‚úÖ Pipeline completed!';
            btn.classList.remove('running');
            btn.innerHTML = '‚úì Complete';
            
            await sleep(3000);
            progress.classList.remove('visible');
            btn.innerHTML = '‚ñ∂ Run Pipeline';
            isRunning = false;
        }

        function resetPipeline() {
            if (isRunning) return;
            document.querySelectorAll('.node').forEach(n => {
                n.classList.remove('running', 'completed', 'selected');
            });
            document.querySelectorAll('.connection-path').forEach(p => {
                p.classList.remove('active', 'completed');
                p.setAttribute('marker-end', 'url(#arrowhead)');
            });
            document.getElementById('progressFill').style.width = '0%';
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Close panel on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closePanel();
            }
        });

        // Close panel when clicking on canvas (outside nodes)
        document.getElementById('canvasContainer').addEventListener('click', (e) => {
            if (e.target.id === 'canvasContainer' || 
                e.target.classList.contains('connections-svg') ||
                e.target.classList.contains('nodes-container')) {
                closePanel();
            }
        });

        // Initialize
        window.onload = init;
        window.onresize = drawConnections;
    </script>
</body>
</html>